!!ExportedWorkflow
apiVersion: torq.io/v2alpha
kind: Workflow
id: 7de95315-bb64-49e8-bfa4-817361c94e6f
name: QAct - Add MITRE Layer to Malware Case
trigger:
  onDemandTrigger:
    parameterList:
      parameters: []
playbook:
  steps:
    - name: us-docker.pkg.dev/stackpulse/public/torq_cases/get-custom-field-value:1.0.1
      id: get_ttps_from_case
      env:
        CASE_ID: '{{ $.metadata.case.id }}'
        KEY: MITRE TTPs
      uuid: aadeca75-feaa-4a85-a5da-9328844a6013
      pretty_name: Get TTPs from Case
      options:
        executor:
          name: torq_cases_get-custom-field-value_v_1_0_1
          env: {}
          sync: true
          disable: false
      manifestId: 530a29e8-6852-5d5b-a583-e78e5c7f636b
      isPrivate: false
      mock_output:
        enabled: false
      skip: false
    - name: us-docker.pkg.dev/stackpulse/public/utils/string_utils/split-text:1.1.2
      id: ttps_list
      env:
        INPUT: '{{ $.get_ttps_from_case.value }}'
        SEPARATOR: ','
      uuid: ccfae1f5-a900-48e1-aea4-411470f743fd
      pretty_name: TTPs List
      options:
        executor:
          name: utils_infrastructure_v_1_3_39
          env:
            COMMAND: split_text
          sync: true
          disable: false
      manifestId: 28047e6e-0866-4508-aa69-b60d18c9a593
      isPrivate: false
      mock_output:
        enabled: false
      skip: false
    - trigger:
        id: create_att_ck_layer_from_ttp_list
        playbook_id: dd23a8b6-dddc-403d-a7bc-7d0723b1b0b0
        pretty_name: Create Att&ck Layer from TTP List
        uuid: 7425641b-4b44-4bbe-a885-4a43cd68cce5
        input: |-
          {
            "ttps_list": {{ $.ttps_list.result }},
            "layer_name": "Case_{{ $.metadata.case.id }}_MITRE_Layer",
            "ttp_color": "02bfd4"
          }
        playbook_name: Create Att&ck Layer from TTP List
        mock_output:
          enabled: false
          payload: '{}'
    - parallel:
        uuid: 9710468e-84d8-4b55-9298-8b058dd67706
        pretty_name: Parallel Executions
        threads:
          - uuid: f4858197-ff59-49d0-9fbe-dfa645f072b8
            steps:
              - name: us-docker.pkg.dev/stackpulse/public/utils/encoding_utils/encode-base64:1.1.2
                id: b64encoded_layer
                env:
                  INPUT: '{{ $.create_att_ck_layer_from_ttp_list.layer }}'
                uuid: 65c7dfc4-1ded-49d1-8472-106ceb48a50b
                pretty_name: B64Encoded Layer
                options:
                  executor:
                    name: utils_infrastructure_v_1_3_44
                    env:
                      COMMAND: encode_base64
                    sync: true
                    disable: false
                manifestId: 425df1ed-7820-4cb4-814d-e93b306975b6
                isPrivate: false
                mock_output:
                  enabled: false
                skip: false
              - name: us-docker.pkg.dev/stackpulse/public/torq_cases/add-attachment:3.0.3
                id: add_attachment_to_case
                env:
                  CASE_ID: '{{ $.metadata.case.id }}'
                  FILE: '{{ $.b64encoded_layer.result }}'
                  FILE_NAME: Case_{{ $.metadata.case.id }}_MITRE_Layer.json
                  INPUT_TYPE: file
                uuid: b72e1466-6989-4030-ad5b-5ef06b04eda3
                pretty_name: Add attachment to case
                options:
                  executor:
                    name: torq_cases_infra_v_3_0_3
                    env:
                      COMMAND: add_attachment
                    sync: true
                    disable: false
                manifestId: 34b0f7cd-6b1b-5011-9b7b-fc701359c556
                isPrivate: false
                mock_output:
                  enabled: false
                skip: false
          - uuid: 138f3bc1-1c56-45b0-89a9-b762695dd837
            steps:
              - name: us-docker.pkg.dev/stackpulse/public/torq_cases/add-attachment:3.0.3
                id: add_svg_layer_to_case
                env:
                  CASE_ID: '{{ $.metadata.case.id }}'
                  CONTENT_TYPE: image/svg+xml
                  FILE: '{{ $.create_att_ck_layer_from_ttp_list.svg_layer }}'
                  FILE_NAME: Case_{{ $.metadata.case.id }}_MITRE_Layer.svg
                  INPUT_TYPE: file
                uuid: 9ab111a5-6b7a-41d4-a83d-a775cc645b47
                pretty_name: Add SVG layer to case
                options:
                  executor:
                    name: torq_cases_infra_v_3_0_3
                    env:
                      COMMAND: add_attachment
                    sync: true
                    disable: false
                manifestId: 34b0f7cd-6b1b-5011-9b7b-fc701359c556
                isPrivate: false
                mock_output:
                  enabled: false
                skip: false
              - name: us-docker.pkg.dev/stackpulse/public/torq_cases/add-tags:3.2.2
                id: add_mitrelayer_tag
                env:
                  CASE_ID: '{{ $.metadata.case.id }}'
                  CASE_TAGS: MITRE Layer
                uuid: c5df7977-3e97-458f-8e2d-60004e81848a
                pretty_name: Add MITRELayer Tag
                options:
                  executor:
                    name: torq_cases_add_tags_v_3_2_2
                    env: {}
                    sync: true
                    disable: false
                manifestId: 8e2c0f35-40d7-512c-b624-ebcafd05cc63
                isPrivate: false
                mock_output:
                  enabled: false
                skip: false
              - name: ozikox/svgconvert:1.0.1
                id: convert_svg_to_pdf
                env:
                  FORMAT: pdf
                  SVGB64: '{{ $.create_att_ck_layer_from_ttp_list.svg_layer }}'
                runner: silliconvalley
                ignoreFailure: true
                uuid: abb4dac8-3fe3-4105-a405-d368deccb736
                pretty_name: Convert SVG to PDF
                options: {}
                icon: https://cdn-icons-png.flaticon.com/512/29/29495.png
                manifestId: 606ec72d-4226-53ac-a144-63055ae8dbe9
                isPrivate: false
                isPrivateUrl: true
                mock_output:
                  enabled: false
                skip: true
              - name: us-docker.pkg.dev/stackpulse/public/torq_cases/add-attachment:3.0.3
                id: add_pdf_layer_to_case
                env:
                  CASE_ID: "84"
                  CONTENT_TYPE: application/x-pdf
                  FILE: '{{ $.convert_svg_to_pdf.output }}'
                  FILE_NAME: Case_84_MITRE_Layer.pdf
                  INPUT_TYPE: file
                ignoreFailure: true
                uuid: bdfc258a-e403-43c8-9ca0-3fdc24d0f2c3
                pretty_name: Add  PDF layer to case
                options:
                  executor:
                    name: torq_cases_infra_v_3_0_3
                    env:
                      COMMAND: add_attachment
                    sync: true
                    disable: false
                manifestId: 34b0f7cd-6b1b-5011-9b7b-fc701359c556
                isPrivate: false
                mock_output:
                  enabled: false
                skip: true
    - exit:
        success: "true"
        pretty_name: Exit
        output: '{}'
        uuid: 5319be18-3cd9-42ca-bf90-1b7aec2a94b4
  annotations:
    - uuid: 6c56f5e6-7e55-49a1-81ab-bea302e86932
      x: 339
      "y": 90
      content: '{"type":"doc","content":[{"type":"paragraph","content":[{"type":"text","text":"This WF is a Quick action for adding. a MITRE Attack Layer in JSON format that can be visualized in MITRE''s Navigator"}]}]}'
    - uuid: b5f9bd06-e10a-4081-ab54-14ca56649df7
      x: 498
      "y": 893
      attachedStepId: abb4dac8-3fe3-4105-a405-d368deccb736
      attachedDistance:
        x: -358
        "y": -94
      content: '{"type":"doc","content":[{"type":"heading","attrs":{"level":2},"content":[{"type":"text","text":"Custom container with Cairo"}]}]}'
  output_schema: '{}'
root: true
