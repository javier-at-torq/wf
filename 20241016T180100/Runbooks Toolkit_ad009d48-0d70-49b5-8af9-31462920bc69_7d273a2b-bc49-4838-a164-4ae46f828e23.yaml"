!!ExportedWorkflow
apiVersion: torq.io/v2alpha
kind: Workflow
id: ad009d48-0d70-49b5-8af9-31462920bc69
name: Runbooks Toolkit
trigger:
  onDemandTrigger:
    parameterList:
      parameters:
        - name: action
          description: The name of the action to execute in this workflow
          required: true
          prettyName: action
          singleSelect:
            options:
              - help
              - list_runbooks
              - associate_runbook
            defaultValue: ""
        - name: runbook_id
          description: The id of the runbook you want to associate
          prettyName: runbook_id
          shortText:
            defaultValue: ""
        - name: case_id
          description: The Id of the case you are working on
          required: true
          prettyName: case_id
          shortText:
            defaultValue: ""
playbook:
  steps:
    - switch:
        uuid: b0673499-ee56-4deb-803e-2f568095e6e3
        pretty_name: Switch
        cases:
          - id: b65102cb-001f-4bd7-bb05-c3194e37c2e4
            pretty_name: List Runbooks
            conditions:
              or:
                - and:
                    - lvalue: '{{ $.event.action }}'
                      operator: EQUALS
                      rvalue: list_runbooks
            steps:
              - name: us-docker.pkg.dev/stackpulse/public/torq_cases/list-runbooks:1.8.0
                id: list_all_runbooks
                uuid: 3880dd45-c965-452b-8a43-dc52964eae83
                pretty_name: List all runbooks
                options:
                  executor:
                    name: torq_cases_list-runbooks_v_1_8_0
                    env: {}
                    sync: true
                    disable: false
                manifestId: 0d3c68e7-f5a2-5989-b34f-522048475650
                isPrivate: false
                mock_output:
                  enabled: false
                skip: false
                retry: {}
              - exit:
                  success: "true"
                  pretty_name: Exit
                  output: |-
                    {
                      "result": {{ $.list_all_runbooks.runbooks }}
                    }
                  uuid: 36e053bb-d0c8-48c3-ba01-a3f98e1b97b8
                  use_schema: true
          - id: d1b8016b-8ab3-4928-a48d-6c466be49363
            pretty_name: Associate Runbook
            conditions:
              or:
                - and:
                    - lvalue: '{{ $.event.action }}'
                      operator: EQUALS
                      rvalue: associate_runbook
            steps:
              - name: us-docker.pkg.dev/stackpulse/public/torq_cases/associate-runbook-to-case:1.7.0
                id: associate_a_runbook_to_a_case
                env:
                  CASE_ID: '{{ $.event.case_id }}'
                  RUNBOOK_ID: '{{ $.event.runbook_id }}'
                uuid: a8156d88-9b58-4d84-99ee-b6be698335c0
                pretty_name: Associate a runbook to a case
                options:
                  executor:
                    name: torq_cases_associate-runbook-to-case_v_1_7_0
                    env: {}
                    sync: true
                    disable: false
                manifestId: 58b6bfae-2541-59ca-a914-d0246b0c898e
                isPrivate: false
                mock_output:
                  enabled: false
                skip: false
                retry: {}
              - exit:
                  success: "true"
                  pretty_name: Exit
                  output: |-
                    {
                      "result": {{ $.associate_a_runbook_to_a_case }}
                    }
                  uuid: 6944651e-63ef-459d-a6fa-352091fdaddd
                  use_schema: true
          - id: 2edde8de-83f6-421f-a9a6-aa3f100f8aae
            pretty_name: Help
            conditions:
              or:
                - and:
                    - lvalue: '{{ $.event.action }}'
                      operator: EQUALS
                      rvalue: help
            steps:
              - name: us-docker.pkg.dev/stackpulse/public/slack/message/message:2.1.0
                id: send_message_4
                env:
                  MESSAGE_TEXT: |-
                    Help!
                    {{ $.event }}
                  RECIPIENT: devnull
                envFrom:
                  integrationRef: wolken
                uuid: 90f31566-098c-456b-b449-869866d10e12
                pretty_name: Send Message 4
                options:
                  executor:
                    name: slack_message_message_v_2_1_0
                    env: {}
                    sync: true
                    disable: false
                manifestId: 111abb4b-15cf-5065-8775-2f2662132e88
                isPrivate: false
                mock_output:
                  enabled: false
                skip: false
                retry: {}
              - name: us-docker.pkg.dev/stackpulse/public/utils/output_utils/set-variable:2.2.0
                id: help
                env:
                  DATA_TYPE: string
                  VALUE_STRING: "This workflows provides extra functionallity regarding troq cases for runbooks.\n\nUse the action parameter to choose between: \na) 'fetch_message'\n\n- Use 'list_runbooks': to retrieve s list of details on available runbooks.\n- Use 'associate_runbook': to associate a runbook to a case, needs 'runbook_id' and 'case_id' as parameters.\n"
                  VARIABLE_NAME: help
                uuid: 82a139bb-3ad2-482f-aa68-9c949f87644a
                pretty_name: Help
                options:
                  executor:
                    name: utils_infrastructure_v_1_22_0
                    env:
                      COMMAND: set_variable
                    sync: true
                    disable: false
                manifestId: e430703a-6b6f-5114-9368-5e3fc166edb7
                isPrivate: false
                mock_output:
                  enabled: false
                skip: false
                retry: {}
              - exit:
                  success: "true"
                  pretty_name: Exit
                  output: |-
                    {
                      "result": "{{ jsonEscape $.help.help }}"
                    }
                  uuid: 12572af3-f1a3-4a32-80ab-a223d03bef52
                  use_schema: true
        default:
          id: ca7b4117-36f2-456b-a636-1afca1b1b494
          steps:
            - name: us-docker.pkg.dev/stackpulse/public/slack/message/message:2.1.0
              id: send_message_3
              env:
                MESSAGE_TEXT: |-
                  No valid Action
                  {{ $.event }}
                RECIPIENT: devnull
              envFrom:
                integrationRef: wolken
              uuid: 35939230-4103-4fda-a281-d32f04b805e8
              pretty_name: Send Message 3
              options:
                executor:
                  name: slack_message_message_v_2_1_0
                  env: {}
                  sync: true
                  disable: false
              manifestId: 111abb4b-15cf-5065-8775-2f2662132e88
              isPrivate: false
              mock_output:
                enabled: false
              skip: false
              retry: {}
            - exit:
                success: "true"
                pretty_name: Exit
                output: |-
                  {
                    "result": "It looks like action {{ $.event.action }} is not implemented yet. "
                  }
                uuid: 44c95c71-b8f3-48f1-ac05-901b0b1509ce
                use_schema: true
  output_schema: |-
    {
        "result": {
            "type": 10,
            "prettyName": "result",
            "description": ""
        }
    }
root: true
